<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
    xmlns:pm="http://primefaces.org/mobile"      
    contentType="text/html" renderKitId="PRIMEFACES_MOBILE">
  <f:view>    
  <pm:page>
   <pm:view>
		<ui:include src="../../pages/common/headerScript.xhtml"></ui:include>
   
    <script type="text/javascript">function validateForm(){var a=$("#tab\\:password1").val();var c=$("#tab\\:password2").val();var b=$("#tab\\:re_password").val();var d=true;$("#tab\\:password1").parent().parent().removeClass("error");$("#tab\\:password2").parent().parent().removeClass("error");$("#tab\\:re_password").parent().parent().removeClass("error");$("#tab\\:password1").parent().find(".help-inline").html("");$("#tab\\:password2").parent().find(".help-inline").html("");$("#tab\\:re_password").parent().find(".help-inline").html("");if(a.length==0){$("#tab\\:password1").parent().find(".help-inline").html("#{msgs['error.passwordold']}");$("#tab\\:password1").parent().parent().addClass("error");d=false}if(c.length==0){$("#tab\\:password2").parent().find(".help-inline").html("#{msgs['error.password']}");$("#tab\\:password2").parent().parent().addClass("error");d=false}if(b.length==0){$("#tab\\:re_password").parent().find(".help-inline").html("#{msgs['error.passwordAgain']}");$("#tab\\:re_password").parent().parent().addClass("error");d=false}if(c!=b){$("#tab\\:password2").parent().find(".help-inline").html("#{msgs['password.mismatch']}");$("#tab\\:password2").parent().parent().addClass("error");$("#tab\\:re_password").parent().parent().addClass("error");d=false}return d};</script>
		
	<style>.ui-menu{background:none repeat scroll 0 0 #4baad3;color:#fff;z-index:1000}</style>

    
<h:head></h:head>
<h:body>
	<ui:include src="../../pages/common/headerContent.xhtml"></ui:include>
  <!-- Start: MAIN CONTENT -->
  <div class="content">
    <div class="container">
    	<div class="row">
    		<div class="span2">
          		<div class="smv-leftnav">
          			<!-- Include leftPanel.xhtml -->
          			<ui:include src="../../pages/common/leftPanel.xhtml"></ui:include> 
          		</div>    		
    		</div>
    		<div class="span10">
    			<div class="page-header">
			    	<h1>Change Password</h1>
				</div>
				<div class="row">
					<div class="span10">
	
					 
						<pm:content rendered="#{sessionScope.user_role == 'C' || sessionScope.user_role == 'B' || sessionScope.user_role == 'P' ||sessionScope.user_role == 'T'}">
<div id="myTabContent" class="tab-content">
	<div class="tab-pane active in" id="login">
	
	        	${userAction.clearScreenMessage()}	
			${userAction.setRedirectUri("")}
		<p:panel id="messagePanel" style="border:none;">		
			<c:forEach var="sucMessage" items="${userAction.successMessage}">
					<div class="alert fade in alert-success" syle="display:none;">
						<button class="close" data-dismiss="alert" type="button">×</button>
						<span class="form-message">${sucMessage}</span>
					</div>
			</c:forEach>
			<c:forEach var="errMessage" items="${userAction.errorMessage}">
					<div class="alert fade in alert-error" syle="display:none;">
						<button class="close" data-dismiss="alert" type="button">×</button>
						<span class="form-message">${errMessage}</span>
					</div>
			</c:forEach>	
			${userAction.clearScreenMessage()}
		</p:panel>	
		
		<h:form id="tab" class="form-horizontal">
			<fieldset>
			
						
			<span class="span6">
				<pm:content id="pannel">
					<div class="control-group">
						<label class="control-label" for="password1" style="margin-left: -14px;width: 120px;">Old Password<i class="icon-asterisk error-icon"></i></label>
						<div class="controls">
							<h:inputSecret id="password1" styleClass="input-large" value="#{userAction.userRegistrationDTO.oldPassword}" />
							<span class="help-inline"></span>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="password2" style="margin-left: -14px;width: 120px;">Password<i class="icon-asterisk error-icon"></i></label>
						<div class="controls">
							<p:password id="password2" styleClass="input-large" value="#{userAction.userRegistrationDTO.repassword}" label="password"/>
							<span class="help-inline"></span> 
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="re_password" style="margin-left: -14px;width: 120px;">Retype Password<i class="icon-asterisk error-icon"></i></label>
						<div class="controls">
							<p:password id="re_password" styleClass="input-large" value="#{userAction.userRegistrationDTO.repassword1}"/>
							<span class="help-inline"></span> 
						</div>
					</div>
					<div class="control-group">
						<div class="controls">
						<h:inputHidden id="redirect" value="#{userAction.redirectUri}"/>
						<h:commandLink  styleClass="btn btn-success" value="Change Password" onclick="return validateForm();">
							<p:ajax listener="#{userAction.changePassword}" process=":tab" update=":tab,:messagePanel" onsuccess="setTimeout(function(){ if($('#tab\\:redirect').val().trim().length > 0) { window.location = location.href.substring(0, location.href.indexOf('/pages/') + 1) + $('#tab\\:redirect').val(); } }, 2000);"></p:ajax>
						</h:commandLink>
						</div>
					</div>
				</pm:content>
			
			</span>
			</fieldset>
		</h:form>
	</div>
</div>
			</pm:content>
					</div>
				</div>
    		</div>
    	</div>
    	
    	
      
    </div>
  </div>
  
  <!-- End: MAIN CONTENT -->

	<ui:include src="../../pages/common/footer-content.xhtml"></ui:include>

</h:body>




</pm:view>
</pm:page>
</f:view>
</html>
